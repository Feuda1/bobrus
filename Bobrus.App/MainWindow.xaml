<Window x:Class="Bobrus.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Bobrus.App"
        mc:Ignorable="d"
        Title="Bobrus"
        Height="520"
        Width="1024"
        MinHeight="640"
        MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Language="ru-RU"
        WindowStyle="None"
        ResizeMode="CanResize"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        Background="{StaticResource BackgroundBrush}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="8"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Grid Background="{StaticResource BackgroundBrush}" x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Top bar -->
        <Grid Grid.Row="0"
              Background="{StaticResource TopBarBrush}"
              Height="52"
              SnapsToDevicePixels="True"
              MouseLeftButtonDown="OnTopBarMouseDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Margin="14 0 12 0" VerticalAlignment="Center">
                <TextBlock Text="bobrus" FontSize="20" FontWeight="Bold" />
                <Border Background="{StaticResource SurfaceBrush}" Padding="8 4" CornerRadius="6" BorderBrush="{StaticResource BorderBrushMuted}" BorderThickness="1" Margin="8 0 0 0">
                    <TextBlock x:Name="VersionText" Text="Версия" Foreground="{StaticResource TextSecondaryBrush}" />
                </Border>
            </StackPanel>

            <Grid Grid.Column="1" />

            <Grid Grid.Column="2" VerticalAlignment="Center" Margin="0 0 12 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center" Margin="0 0 12 0">
                    <Button x:Name="CheckUpdatesButton"
                            Width="160"
                            Style="{StaticResource AccentButton}"
                            Click="OnCheckUpdatesClicked">
                        Проверить обновления
                    </Button>
                    <TextBlock x:Name="UpdateStatusText"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="8 0 0 0" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Grid.Column="1" VerticalAlignment="Center" Margin="10 0 0 0">
                    <Button Style="{StaticResource WindowIconButton}"
                            Click="OnMinimizeClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,6 L8,12 L14,6" />
                        </Viewbox>
                    </Button>
                    <Button Style="{StaticResource WindowIconButton}"
                            Margin="6 0 0 0"
                            Click="OnToggleMaximizeClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,10 L8,4 L14,10" />
                        </Viewbox>
                    </Button>
                    <Button Style="{StaticResource WindowCloseButton}"
                            Margin="6 0 0 0"
                            Click="OnCloseClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,4 L14,16 M14,4 L2,16" />
                        </Viewbox>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Search bar -->
        <Grid Grid.Row="1" Margin="16 12 16 8">
            <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrushMuted}"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="12 10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Viewbox Width="18" Height="18" VerticalAlignment="Center">
                        <Path Stroke="{StaticResource TextSecondaryBrush}"
                              StrokeThickness="1.4"
                              Data="M10,14 A4,4 0 1 1 14,10 L18,14" />
                    </Viewbox>
                    <TextBlock Grid.Column="1"
                               Margin="10 0 0 0"
                               VerticalAlignment="Center"
                               Text="Поиск функций (Ctrl+K)"
                               Foreground="{StaticResource TextSecondaryBrush}" />
                </Grid>
            </Border>
        </Grid>

        <!-- Main layout -->
        <Grid Grid.Row="2" Margin="16 0 16 16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

                <!-- Sidebar -->
                <Border Grid.Column="0"
                        Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="16"
                        MinWidth="220"
                        MaxWidth="260">
                    <StackPanel Orientation="Vertical">
                        <TextBlock Text="Разделы" FontWeight="SemiBold" Margin="0 0 0 10" />
                        <Button Content="Система" Style="{StaticResource NavButton}" Margin="0 0 0 8" />
                        <Button Content="IIKO" Style="{StaticResource NavButton}" IsEnabled="False" Margin="0 0 0 8" />
                        <Button Content="Логи" Style="{StaticResource NavButton}" IsEnabled="False" Margin="0 0 0 8" />
                        <Button Content="Папки" Style="{StaticResource NavButton}" IsEnabled="False" Margin="0 0 0 8" />
                        <Button Content="Сеть" Style="{StaticResource NavButton}" IsEnabled="False" Margin="0 0 0 8" />
                        <Button Content="Программы" Style="{StaticResource NavButton}" IsEnabled="False" Margin="0 0 0 8" />
                        <Button Content="Плагины" Style="{StaticResource NavButton}" IsEnabled="False" />
                    </StackPanel>
                </Border>

                <!-- Content area -->
                <Grid Grid.Column="1" Margin="16 0 0 0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>

                    <!-- System functions -->
                    <Border Style="{StaticResource CardBorder}" Grid.Column="0" Padding="18" Margin="0 0 14 0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <TextBlock Text="Системные функции"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       Margin="0 0 0 14" />

                        <WrapPanel Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                            <Button Content="Перезагрузить ПК"
                                    Style="{StaticResource BaseButton}"
                                    Height="44"
                                    MinWidth="170"
                                    Margin="0 12 12 12"
                                    Click="OnRebootClicked" />
                            <Button x:Name="TouchToggleButton"
                                    Content="Сенсор: проверка..."
                                    Style="{StaticResource BaseButton}"
                                    Height="44"
                                    MinWidth="170"
                                    Margin="0 12 12 12"
                                    Click="OnTouchToggleClicked" />
                            <Button Content="Перезапуск сенсора"
                                    Style="{StaticResource BaseButton}"
                                    Height="44"
                                    MinWidth="170"
                                    Margin="0 12 12 12"
                                    Click="OnRestartTouchClicked" />
                            <Button Content="Перезапуск COM-портов"
                                    Style="{StaticResource BaseButton}"
                                    Height="44"
                                    MinWidth="170"
                                    Margin="0 12 12 12"
                                    Click="OnRestartComClicked" />
                            <Button Content="Очистить мусор"
                                    Style="{StaticResource BaseButton}"
                                    Height="44"
                                    MinWidth="170"
                                    Margin="0 12 12 12"
                                    Click="OnCleanupClicked" />
                        </WrapPanel>
                    </Grid>
                </Border>

                    <!-- Log panel -->
                    <Border Style="{StaticResource CardBorder}" Grid.Column="1" Padding="16">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0 0 0 12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Журнал"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center" />
                                <Button Content="Очистить"
                                        Style="{StaticResource BaseButton}"
                                        Width="120"
                                        Margin="10 0 0 0"
                                        Click="OnClearLogClicked"
                                        Grid.Column="1" />
                            </Grid>

                            <Border Grid.Row="2"
                                    Margin="0 10 0 0"
                                    Background="#0C0C10"
                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="10">
                                <RichTextBox x:Name="LogRichTextBox"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             IsReadOnly="True"
                                             IsDocumentEnabled="False"
                                             IsHitTestVisible="True"
                                             VerticalScrollBarVisibility="Auto"
                                             HorizontalScrollBarVisibility="Disabled"
                                             Padding="0"
                                             Foreground="{StaticResource TextPrimaryBrush}">
                                    <FlowDocument>
                                        <Paragraph/>
                                    </FlowDocument>
                                </RichTextBox>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        <!-- Notification stack -->
        <Grid Grid.RowSpan="3"
              IsHitTestVisible="False"
              VerticalAlignment="Bottom"
              HorizontalAlignment="Right"
              Margin="16 16 16 24">
            <StackPanel x:Name="NotificationStack"
                        Orientation="Vertical"
                        Width="320"
                        VerticalAlignment="Bottom" />
        </Grid>

        <!-- Confirmation overlay -->
        <Grid x:Name="ConfirmOverlay"
              Grid.RowSpan="3"
              Background="#88000000"
              Visibility="Collapsed">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="400">
                <Border Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="18">
                    <StackPanel>
                        <TextBlock x:Name="ConfirmTitle"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Margin="0 0 0 8" />
                        <TextBlock x:Name="ConfirmMessage"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0 0 0 12" />
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Отмена"
                                    Style="{StaticResource BaseButton}"
                                    Width="100"
                                    Margin="0 0 10 0"
                                    Click="OnConfirmCancelClicked" />
                            <Button Content="Подтвердить"
                                    Style="{StaticResource AccentButton}"
                                    Width="120"
                                    Click="OnConfirmAcceptClicked" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
