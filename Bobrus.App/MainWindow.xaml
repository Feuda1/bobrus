<Window x:Class="Bobrus.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Bobrus.App"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Bobrus"
        Height="520"
        Width="960"
        MinHeight="560"
        MinWidth="760"
        WindowStartupLocation="CenterScreen"
        Language="ru-RU"
        WindowStyle="None"
        ResizeMode="CanResize"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        Background="{StaticResource BackgroundBrush}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="8"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Grid Background="{StaticResource BackgroundBrush}" x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Top bar -->
        <Grid Grid.Row="0"
              Background="{StaticResource TopBarBrush}"
              Height="60"
              Margin="0"
              SnapsToDevicePixels="True"
              MouseLeftButtonDown="OnTopBarMouseDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Margin="14 0 12 0" VerticalAlignment="Center">
                <TextBlock Text="bobrus" FontSize="20" FontWeight="Bold" />
                <TextBlock x:Name="VersionText"
                           Margin="10 0 0 0"
                           VerticalAlignment="Center"
                           Foreground="{StaticResource TextSecondaryBrush}" />
                <StackPanel x:Name="GlobalProgressPanel"
                            Orientation="Horizontal"
                            Margin="10 0 0 0"
                            VerticalAlignment="Center"
                            Visibility="Collapsed">
                    <ProgressBar x:Name="GlobalProgressBar"
                                 Width="120"
                                 Height="6"
                                 Minimum="0"
                                 Maximum="100"
                                 VerticalAlignment="Center" />
                    <TextBlock x:Name="GlobalProgressText"
                               Margin="8 0 0 0"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource TextSecondaryBrush}" />
                </StackPanel>
            </StackPanel>

            <Grid Grid.Column="1" />

            <Grid Grid.Column="2" VerticalAlignment="Center" Margin="0 0 12 0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center" Margin="0 0 12 0">
                    <Button x:Name="SettingsButton"
                            Width="130"
                            Style="{StaticResource BaseButton}"
                            Click="OnOpenSettingsClicked">
                        Настройки
                    </Button>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Grid.Column="1" VerticalAlignment="Center" Margin="10 0 0 0">
                    <Button Style="{StaticResource WindowIconButton}"
                            Click="OnMinimizeClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,6 L8,12 L14,6" />
                        </Viewbox>
                    </Button>
                    <Button Style="{StaticResource WindowIconButton}"
                            Margin="6 0 0 0"
                            Click="OnToggleMaximizeClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,10 L8,4 L14,10" />
                        </Viewbox>
                    </Button>
                    <Button Style="{StaticResource WindowCloseButton}"
                            Margin="6 0 0 0"
                            Click="OnCloseClicked">
                        <Viewbox Stretch="Uniform" Width="16" Height="16">
                            <Path Stroke="{StaticResource TextPrimaryBrush}"
                                  StrokeThickness="1.8"
                                  StrokeEndLineCap="Round"
                                  StrokeStartLineCap="Round"
                                  Data="M2,4 L14,16 M14,4 L2,16" />
                        </Viewbox>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Search bar -->
        <Grid Grid.Row="1" Margin="12 10 12 8">
            <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrushMuted}"
                    BorderThickness="1"
                    CornerRadius="10"
                    Padding="10 8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Viewbox Width="18" Height="18" VerticalAlignment="Center">
                        <Path Stroke="{StaticResource TextSecondaryBrush}"
                              StrokeThickness="1.6"
                              StrokeLineJoin="Round"
                              StrokeStartLineCap="Round"
                              StrokeEndLineCap="Round"
                              Data="M7.5,2 A5.5,5.5 0 1 1 2,7.5 A5.5,5.5 0 0 1 7.5,2 M11.5,11.5 L16,16" />
                    </Viewbox>
                    <TextBox x:Name="SearchBox"
                             Grid.Column="1"
                             Margin="10 0 0 0"
                             Background="Transparent"
                             BorderThickness="0"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             CaretBrush="{StaticResource AccentBrush}"
                             FontSize="14"
                             TextChanged="OnSearchTextChanged"
                             KeyDown="OnSearchKeyDown"
                             Tag="Поиск функций (Ctrl+K)"
                             />
                </Grid>
            </Border>
        </Grid>

        <!-- Main layout -->
        <Grid Grid.Row="2" Margin="12 0 12 12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" MinWidth="480" />
                <ColumnDefinition Width="1*" MinWidth="220" MaxWidth="360" />
            </Grid.ColumnDefinitions>

                <!-- Content area -->
                <ScrollViewer Grid.Column="0"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="0"
                              Margin="0 0 0 0">
                    <StackPanel Orientation="Vertical">
                        <!-- System functions -->
                        <Border x:Name="SystemCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Системные функции"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <WrapPanel x:Name="ActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button Content="Перезагрузить ПК"
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnRebootClicked"
                                            Tag="reboot перезагрузка рестарт" />
                                    <Button x:Name="TouchToggleButton"
                                            Content="Сенсор: проверка..."
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnTouchToggleClicked"
                                            Tag="сенсор touch включить отключить" />
                                    <Button Content="Перезапуск сенсора"
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnRestartTouchClicked"
                                            Tag="сенсор перезапуск touch reset" />
                                    <Button Content="Перезапуск COM-портов"
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnRestartComClicked"
                                            Tag="com port serial rs232" />
                                    <Button Content="Перезапуск и очистка дисп. печати"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="230"
                                            Margin="0 12 12 12"
                                            Click="OnRestartPrintSpoolerClicked"
                                            Tag="печать spooler очередь принтер" />
                                    <Button Content="Настройка TLS 1.2"
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnConfigureTlsClicked"
                                            Tag="tls ssl протокол" />
                                    <Button Content="Очистить мусор"
                                            Style="{StaticResource FunctionButton}"
                                            Margin="0 12 12 12"
                                            Click="OnCleanupClicked"
                                            Tag="очистка temp кеш cache браузер" />
                                    <Button Content="Отключить защиту и брандмауэр"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="220"
                                            Margin="0 12 12 12"
                                            Click="OnDisableSecurityClicked"
                                            Tag="defender firewall защита брандмауэр отключить" />
                                </WrapPanel>
                            </Grid>
                        </Border>

                        <!-- Network -->
                        <Border x:Name="NetworkCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Сеть"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <WrapPanel x:Name="NetworkActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button Content="Диагностика сети"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="200"
                                            Margin="0 12 12 12"
                                            Click="OnNetworkDiagnosticsClicked"
                                            Tag="сеть ipconfig ping диагностика проверка связи" />
                                </WrapPanel>
                            </Grid>
                        </Border>

                        <!-- IIKO functions -->
                        <Border x:Name="IikoCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="IIKO"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <WrapPanel x:Name="IikoActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button Content="Закрыть iikoFront"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="180"
                                            Margin="0 12 12 12"
                                            Click="OnCloseIikoFrontClicked"
                                            Tag="iiko front закрыть завершить процесс" />
                                    <Button Content="Перезапустить iikoFront"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="200"
                                            Margin="0 12 12 12"
                                            Click="OnRestartIikoFrontClicked"
                                            Tag="iiko front перезапуск restart" />
                                    <Button Content="Обновить iikoCard"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="180"
                                            Margin="0 12 12 12"
                                            Click="OnUpdateIikoCardClicked"
                                            Tag="iiko card обновление installer" />
                                </WrapPanel>
                            </Grid>
                        </Border>


                        <!-- Programs -->
                        <Border x:Name="ProgramsCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Программы"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <WrapPanel x:Name="ProgramsActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button x:Name="SevenZipButton"
                                            Content="7-Zip"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnSevenZipClicked"
                                            Tag="7zip архиватор 32 64 семизип" />
                                    <Button x:Name="AdvancedIpScannerButton"
                                            Content="Advanced IP Scanner"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="210"
                                            Margin="0 12 12 12"
                                            Click="OnAdvancedIpScannerClicked"
                                            Tag="advanced ip scanner сеть сканер">
                                    </Button>
                                    <Button x:Name="AnyDeskButton"
                                            Content="AnyDesk"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="150"
                                            Margin="0 12 12 12"
                                            Click="OnAnyDeskClicked"
                                            Tag="anydesk удаленный доступ ремоут">
                                    </Button>
                                    <Button x:Name="AssistantButton"
                                            Content="Ассистент"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="160"
                                            Margin="0 12 12 12"
                                            Click="OnAssistantClicked"
                                            Tag="ассистент помощник мойассистент">
                                    </Button>
                                    <Button x:Name="ComPortCheckerButton"
                                            Content="Com Port Checker"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnComPortCheckerClicked"
                                            Tag="com port checker comport serial">
                                    </Button>
                                    <Button x:Name="DatabaseNetButton"
                                            Content="Database Net"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnDatabaseNetClicked"
                                            Tag="database net база данных">
                                    </Button>
                                    <Button x:Name="NotepadButton"
                                            Content="Notepad++"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnNotepadClicked"
                                            Tag="notepad++ блокнот npp 32 64" />
                                    <Button x:Name="PrinterTestButton"
                                            Content="Printer Test V3.1C"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="200"
                                            Margin="0 12 12 12"
                                            Click="OnPrinterTestClicked"
                                            Tag="printer test чек тест принтер печать">
                                    </Button>
                                    <Button x:Name="RhelperButton"
                                            Content="Rhelper"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="150"
                                            Margin="0 12 12 12"
                                            Click="OnRhelperClicked"
                                            Tag="rhelper удаленный доступ remote">
                                    </Button>
                                    <Button x:Name="OrderCheckButton"
                                            Content="OrderCheck"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="160"
                                            Margin="0 12 12 12"
                                            Click="OnOrderCheckClicked"
                                            Tag="ordercheck order check iiko отчет">
                                    </Button>
                                    <Button x:Name="ClearBatButton"
                                            Content="CLEAR.bat"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="150"
                                            Margin="0 12 12 12"
                                            Click="OnClearBatClicked"
                                            Tag="clear bat очистка">
                                    </Button>
                                    <Button x:Name="FrontToolsButton"
                                            Content="FrontTools"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="180"
                                            Margin="0 12 12 12"
                                            Click="OnFrontToolsClicked"
                                            Tag="fronttools iikotools sqlite" />
                                </WrapPanel>
                            </Grid>
                        </Border>
                        <!-- Logs -->
                        <Border x:Name="LogsCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Логи"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <Grid Grid.Row="1">
                                <WrapPanel x:Name="LogsActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button Content="config.xml"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="150"
                                            Margin="0 12 12 12"
                                            Click="OnOpenConfigLogClicked"
                                            Tag="лог config cashserver конфиг конфик" />
                                    <Button Content="cash-server.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenCashServerLogClicked"
                                            Tag="лог cash server cashserver кэшсервер кешсервер кеш сервер кэш сервер" />
                                    <Button Content="OnlineMarking.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenOnlineMarkingLogClicked"
                                            Tag="лог online marking маркировка марки честный знак чз" />
                                    <Button Content="dualConnector.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenDualConnectorLogClicked"
                                            Tag="лог dualconnector терминал оплата" />
                                    <Button Content="AlcoholMarking.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenAlcoholLogClicked"
                                            Tag="лог alcohol marking алкоголь алкашка" />
                                    <Button Content="Sberbank.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenSberbankLogClicked"
                                            Tag="лог sberbank оплата сбер сбербанк банк" />
                                    <Button Content="virtual-printer.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenVirtualPrinterLogClicked"
                                            Tag="лог virtualprinter виртуалпринтер виртуал принтер принтер" />
                                    <Button Content="Error.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="140"
                                            Margin="0 12 12 12"
                                            Click="OnOpenErrorLogClicked"
                                            Tag="лог ошибки ошибка error еррор ерор" />
                                    <Button Content="Transport.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenTransportLogClicked"
                                            Tag="лог transport плагин транспорт" />
                                    <Button Content="Delivery.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenDeliveryLogClicked"
                                            Tag="лог delivery доставка деливери диливири диливери" />
                                    <Button Content="messages.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenMessagesLogClicked"
                                            Tag="лог message messages месаге меседж месседж мэседж сообщения оповещения" />
                                    <Button Content="UTM transport_info.log"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="210"
                                            Margin="0 12 12 12"
                                            Click="OnOpenUtmTransportLogClicked"
                                            Tag="лог utm transport логи утм утм транспорт" />
                                    <Button Content="Собрать логи"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="160"
                                            Margin="0 12 12 12"
                                            Click="OnCollectLogsClicked"
                                            Tag="сбор логов logs архив" />
                                </WrapPanel>
                                </Grid>
                            </Grid>
                        </Border>

                        <!-- Folders -->
                        <Border x:Name="FoldersCard" Style="{StaticResource CardBorder}" Padding="18">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Папки"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Margin="0 0 0 14" />

                                <WrapPanel x:Name="FoldersActionsPanel" Grid.Row="1" Margin="0" HorizontalAlignment="Stretch">
                                    <Button Content="Logs"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderLogsClicked"
                                            Tag="папка логи cashserver logs лог" />
                                    <Button Content="EntitiesStorage"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderEntitiesClicked"
                                            Tag="папка entities storage энтитисторадже энтити сторадже бд база данных база" />
                                    <Button Content="CashServer"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderCashServerClicked"
                                            Tag="папка cashserver кэшсервер кешсервер кеш сервер кэш сервер" />
                                    <Button Content="Plugins"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="170"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderPluginsClicked"
                                            Tag="папка front plugins плагин плагины" />
                                    <Button Content="UTM"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="140"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderUtmClicked"
                                            Tag="папка utm утм" />
                                    <Button Content="PluginConfigs"
                                            Style="{StaticResource FunctionButton}"
                                            MinWidth="190"
                                            Margin="0 12 12 12"
                                            Click="OnOpenFolderPluginConfigsClicked"
                                            Tag="папка pluginconfigs plugin configs конфиги плагинов" />
                                </WrapPanel>
                            </Grid>
                        </Border>

                        <!-- Plugins -->
                        <Border x:Name="PluginsCard" Style="{StaticResource CardBorder}" Padding="18" Margin="0 0 0 14">
                            <Grid>
                                <Grid.Resources>
                                    <Style x:Key="PluginListBoxStyle" TargetType="ListBox">
                                        <Setter Property="Background" Value="{StaticResource PanelBrush}" />
                                        <Setter Property="BorderBrush" Value="{StaticResource BorderBrushMuted}" />
                                        <Setter Property="BorderThickness" Value="1" />
                                        <Setter Property="Padding" Value="8" />
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
                                        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
                                        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBox">
                                                    <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ScrollViewer Focusable="False">
                                                            <ItemsPresenter />
                                                        </ScrollViewer>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <Style x:Key="PluginListItemStyle" TargetType="ListBoxItem">
                                        <Setter Property="Padding" Value="8 6" />
                                        <Setter Property="Margin" Value="0 4 0 4" />
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="Bd"
                                                            Background="{StaticResource SurfaceBrush}"
                                                            BorderBrush="{StaticResource BorderBrushMuted}"
                                                            BorderThickness="1"
                                                            CornerRadius="8"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource AccentBrush}" />
                                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
                                                        </Trigger>
                                                        <Trigger Property="IsEnabled" Value="False">
                                                            <Setter TargetName="Bd" Property="Opacity" Value="0.8" />
                                                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource SurfaceBrush}" />
                                                            <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource BorderBrushMuted}" />
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>

                                    <DataTemplate x:Key="PluginItemTemplate">
                                        <TextBlock Text="{Binding DisplayName}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   TextTrimming="CharacterEllipsis" />
                                    </DataTemplate>
                                </Grid.Resources>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0 0 0 12">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <TextBlock Text="Плагины"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center" />

                                <Grid Grid.Row="1" Margin="0 8 0 0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Border Margin="0 0 10 0"
                                            Background="{StaticResource SurfaceBrush}"
                                            BorderBrush="{StaticResource BorderBrushMuted}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="8 6"
                                            Height="34"
                                            VerticalAlignment="Center"
                                            MinWidth="200"
                                            MaxWidth="320"
                                            HorizontalAlignment="Left">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Viewbox Width="14" Height="14" VerticalAlignment="Center">
                                                <Path Stroke="{StaticResource TextSecondaryBrush}"
                                                      StrokeThickness="1.4"
                                                      StrokeLineJoin="Round"
                                                      StrokeStartLineCap="Round"
                                                      StrokeEndLineCap="Round"
                                                      Data="M7.5,2 A5.5,5.5 0 1 1 2,7.5 A5.5,5.5 0 0 1 7.5,2 M11.5,11.5 L16,16" />
                                            </Viewbox>
                                            <TextBox x:Name="PluginsSearchBox"
                                                     Grid.Column="1"
                                                     Margin="8 0 0 0"
                                                     Background="Transparent"
                                                     BorderThickness="0"
                                                     Foreground="{StaticResource TextPrimaryBrush}"
                                                     CaretBrush="{StaticResource AccentBrush}"
                                                     VerticalContentAlignment="Center"
                                                     TextChanged="OnPluginsSearchChanged"
                                                     Tag="Поиск плагинов"
                                                     MinWidth="160" />
                                        </Grid>
                                    </Border>
                                    <Button Grid.Column="1"
                                            Content="Обновить"
                                            Style="{StaticResource BaseButton}"
                                            Width="120"
                                            Height="32"
                                            Margin="0 0 10 0"
                                            Click="OnRefreshPluginsClicked" />
                                    <Button Grid.Column="2"
                                            x:Name="InstallPluginButton"
                                            Content="Установить"
                                            Style="{StaticResource AccentButton}"
                                            Width="120"
                                            Height="32"
                                            Margin="0 0 0 0"
                                            IsEnabled="False"
                                            Click="OnInstallPluginClicked" />
                                </Grid>

                                <TextBlock x:Name="PluginStatusText"
                                           Grid.Row="2"
                                           Margin="0 6 0 0"
                                               VerticalAlignment="Center"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                </Grid>

                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1.2*" />
                                        <ColumnDefinition Width="1*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Доступные плагины"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Margin="0 0 0 6" />
                                        <ListBox x:Name="PluginsList"
                                                 Height="240"
                                                 MinHeight="200"
                                                 Margin="0 0 10 0"
                                                 SelectionChanged="OnPluginSelected"
                                                 ItemTemplate="{StaticResource PluginItemTemplate}"
                                                 Style="{StaticResource PluginListBoxStyle}"
                                                 ItemContainerStyle="{StaticResource PluginListItemStyle}" />
                                    </StackPanel>

                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Версии"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Margin="0 0 0 6" />
                                        <ListBox x:Name="PluginVersionsList"
                                                 Height="240"
                                                 MinHeight="200"
                                                 Margin="0 0 10 0"
                                                 SelectionChanged="OnPluginVersionSelected"
                                                 ItemTemplate="{StaticResource PluginItemTemplate}"
                                                 Style="{StaticResource PluginListBoxStyle}"
                                                 ItemContainerStyle="{StaticResource PluginListItemStyle}" />
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                    <!-- Log panel -->
                    <Border Style="{StaticResource CardBorder}"
                            Grid.Column="1"
                            Padding="12"
                            Margin="8 0 0 0"
                            MinWidth="220"
                            HorizontalAlignment="Stretch">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Grid Grid.Row="0" Margin="0 0 0 12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Журнал"
                                               FontSize="16"
                                               FontWeight="SemiBold"
                                               VerticalAlignment="Center" />
                                    <Button Content="Очистить"
                                            Style="{StaticResource BaseButton}"
                                            Width="110"
                                            Margin="8 0 0 0"
                                            Click="OnClearLogClicked"
                                            Grid.Column="1" />
                                </Grid>

                                <Border Grid.Row="2"
                                        Margin="0 10 0 0"
                                        Background="#0C0C10"
                                        BorderBrush="{StaticResource BorderBrushMuted}"
                                        BorderThickness="1"
                                        CornerRadius="8"
                                        Padding="8">
                                    <RichTextBox x:Name="LogRichTextBox"
                                                 Background="Transparent"
                                                BorderThickness="0"
                                                IsReadOnly="True"
                                                IsDocumentEnabled="False"
                                                IsHitTestVisible="True"
                                                VerticalScrollBarVisibility="Auto"
                                                HorizontalScrollBarVisibility="Disabled"
                                                Padding="0"
                                                Foreground="{StaticResource TextPrimaryBrush}">
                                        <FlowDocument>
                                            <Paragraph/>
                                        </FlowDocument>
                                    </RichTextBox>
                                </Border>
                            </Grid>
                        </ScrollViewer>
                    </Border>
                </Grid>
        <!-- Notification stack -->
        <Grid Grid.RowSpan="3"
              IsHitTestVisible="False"
              VerticalAlignment="Bottom"
              HorizontalAlignment="Right"
              Margin="16 16 16 24">
            <StackPanel x:Name="NotificationStack"
                        Orientation="Vertical"
                        Width="320"
                        VerticalAlignment="Bottom" />
        </Grid>

        <!-- Program options popup -->
        <Popup x:Name="ProgramOptionsPopup"
               Placement="Bottom"
               AllowsTransparency="True"
               StaysOpen="False">
            <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrushMuted}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="6">
                <StackPanel x:Name="ProgramOptionsPanel"
                            Orientation="Vertical"
                            MinWidth="220"
                            MaxHeight="240" />
            </Border>
        </Popup>

        <!-- Confirmation overlay -->
        <Grid x:Name="ConfirmOverlay"
              Grid.RowSpan="3"
              Background="#88000000"
              Visibility="Collapsed">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="400">
                <Border Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="18">
                    <StackPanel>
                        <TextBlock x:Name="ConfirmTitle"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Margin="0 0 0 8" />
                        <TextBlock x:Name="ConfirmMessage"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0 0 0 12" />
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Отмена"
                                    Style="{StaticResource BaseButton}"
                                    Width="100"
                                    Margin="0 0 10 0"
                                    Click="OnConfirmCancelClicked" />
                            <Button Content="Подтвердить"
                                    Style="{StaticResource AccentButton}"
                                    Width="120"
                                    Click="OnConfirmAcceptClicked" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Network overlay -->
        <Grid x:Name="NetworkOverlay"
              Grid.RowSpan="3"
              Background="#88000000"
              Visibility="Collapsed">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="640" MinHeight="380">
                <Border Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="18 18 18 22">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Сеть"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                            <Button x:Name="NetworkOverlayCloseButton"
                                    Content="✕"
                                    Grid.Column="1"
                                    Style="{StaticResource WindowIconButton}"
                                    Width="32"
                                    Height="28"
                                    Click="OnNetworkOverlayCloseClicked" />
                        </Grid>

                        <StackPanel Margin="0 12 0 0" Orientation="Vertical">
                            <TextBlock Text="Адрес" Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBox x:Name="NetworkPingInput"
                                     Margin="0 6 0 10"
                                     Background="#161620"
                                     Foreground="#EAEAEA"
                                     BorderBrush="{StaticResource BorderBrushMuted}"
                                     BorderThickness="1"
                                     Padding="6 4" />

                            <UniformGrid Columns="4" Rows="1" Margin="0 0 0 10" HorizontalAlignment="Stretch">
                                <Button x:Name="NetworkRunPingButton"
                                        Content="Запустить ping"
                                        Style="{StaticResource BaseButton}"
                                        Height="34"
                                        Margin="0 0 8 0"
                                        Click="OnNetworkRunPingClicked" />
                                <Button x:Name="NetworkRunIpconfigButton"
                                        Content="ipconfig"
                                        Style="{StaticResource BaseButton}"
                                        Height="34"
                                        Margin="8 0 8 0"
                                        Click="OnNetworkRunIpconfigClicked" />
                                <Button x:Name="NetworkRunFullDiagButton"
                                        Content="Полная диагностика"
                                        Style="{StaticResource BaseButton}"
                                        Height="34"
                                        Margin="8 0 8 0"
                                        Click="OnNetworkRunFullDiagClicked" />
                                <Button Content="Очистить вывод"
                                        Style="{StaticResource BaseButton}"
                                        Height="34"
                                        Margin="8 0 0 0"
                                        Click="OnNetworkClearOutputClicked" />
                            </UniformGrid>

                            <TextBlock Text="Вывод"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0 0 0 6" />
                            <Border Background="#0C0C10"
                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                    BorderThickness="1"
                                    CornerRadius="6"
                                    Padding="0"
                                    MinHeight="200"
                                    Height="320">
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled"
                                              Padding="8">
                                    <TextBox x:Name="NetworkOutputBox"
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="{StaticResource TextPrimaryBrush}"
                                             FontFamily="Consolas"
                                             FontSize="13"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             AcceptsTab="True"
                                             IsReadOnly="True" />
                                </ScrollViewer>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Settings overlay -->
        <Grid x:Name="SettingsOverlay"
              Grid.RowSpan="3"
              Background="#88000000"
              Visibility="Collapsed">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="520" MinHeight="220">
                <Border Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="18">
                    <StackPanel>
                        <Grid Margin="0 0 0 12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Настройки"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                            <Button Content="✕"
                                    Grid.Column="1"
                                    Style="{StaticResource WindowIconButton}"
                                    Width="32"
                                    Height="28"
                                    Click="OnSettingsOverlayCloseClicked" />
                        </Grid>

                        <StackPanel Orientation="Vertical" Margin="0 4 0 0">
                            <TextBlock Text="Обновления"
                                       FontSize="14"
                                       FontWeight="SemiBold" />
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0 4 0 0">
                                <Button x:Name="CheckUpdatesButton"
                                        Width="150"
                                        Style="{StaticResource BaseButton}"
                                        Click="OnCheckUpdatesClicked">
                                    Проверить обновления
                                </Button>
                                <TextBlock x:Name="UpdateStatusText"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="10 0 0 0" />
                            </StackPanel>

                            <TextBlock Text="Поведение"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Margin="0 12 0 4" />
                            <StackPanel Orientation="Vertical" Margin="0 0 0 4">
                                <CheckBox x:Name="HideToTrayToggle"
                                          Content="Скрывать в трей при закрытии"
                                          Style="{StaticResource ToggleCheckBox}"
                                          Checked="OnHideToTrayToggleChanged"
                                          Unchecked="OnHideToTrayToggleChanged" />
                                <CheckBox x:Name="AutostartToggle"
                                          Content="Запускать вместе с Windows"
                                          Style="{StaticResource ToggleCheckBox}"
                                          Margin="0 6 0 0"
                                          Checked="OnAutostartToggleChanged"
                                          Unchecked="OnAutostartToggleChanged" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Log collect overlay -->
        <Grid x:Name="LogCollectOverlay"
              Grid.RowSpan="3"
              Background="#88000000"
              Visibility="Collapsed">
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center" Width="620" MinHeight="360">
                <Border Background="{StaticResource PanelBrush}"
                        BorderBrush="{StaticResource BorderBrushMuted}"
                        BorderThickness="1"
                        CornerRadius="10"
                        Padding="18 18 18 30">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Сбор логов"
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                            <Button Content="✕"
                                    Grid.Column="1"
                                    Style="{StaticResource WindowIconButton}"
                                    Width="32"
                                    Height="28"
                                    Click="OnLogCollectOverlayCloseClicked" />
                        </Grid>

                        <StackPanel Margin="0 12 0 0">
                            <TextBlock Text="Выберите период" Foreground="{StaticResource TextSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal" Margin="0 6 0 14">
                                <StackPanel Width="200">
                                    <TextBlock Text="С начала" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" />
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="34" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="CollectStartInput"
                                                     Grid.Column="0"
                                                     Background="#161620"
                                                     Foreground="#EAEAEA"
                                                     BorderBrush="{StaticResource BorderBrushMuted}"
                                                     BorderThickness="1"
                                                     Padding="6 4"
                                                     IsReadOnly="True" />
                                            <Button Grid.Column="1"
                                                    x:Name="CollectStartToggle"
                                                    Background="#1F1F2A"
                                                    Foreground="#EAEAEA"
                                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                                    BorderThickness="1 1 1 1"
                                                    Click="OnCollectStartToggleClicked"
                                                    Padding="0"
                                                    Width="34"
                                                    Height="Auto">
                                                <Path Data="M 0 0 L 4 4 L 8 0 Z"
                                                      Fill="#EAEAEA"
                                                      Stretch="Uniform"
                                                      Width="12"
                                                      Height="8"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                            </Button>
                                        </Grid>
                                        <Popup x:Name="CollectStartPopup"
                                               Placement="Bottom"
                                               PlacementTarget="{Binding ElementName=CollectStartInput}"
                                               AllowsTransparency="True"
                                               StaysOpen="True">
                                            <Border Background="#161620"
                                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="6"
                                                    Width="{Binding ActualWidth, ElementName=CollectStartInput}"
                                                    MaxHeight="260">
                                                <StackPanel>
                                                    <TextBox x:Name="CollectStartSearch"
                                                             Background="#1F1F2A"
                                                             Foreground="#EAEAEA"
                                                             BorderBrush="{StaticResource BorderBrushMuted}"
                                                             BorderThickness="1"
                                                             Padding="4"
                                                             Margin="0 0 0 6"
                                                             TextChanged="OnCollectStartSearchChanged"
                                                             PreviewKeyDown="OnCollectStartSearchPreviewKeyDown"
                                                             GotFocus="OnCollectStartSearchGotFocus" />
                                                    <ScrollViewer MaxHeight="200"
                                                                  VerticalScrollBarVisibility="Auto">
                                                        <ListBox x:Name="CollectStartList"
                                                                 Background="Transparent"
                                                                 BorderThickness="0"
                                                                 Foreground="#EAEAEA"
                                                                 SelectionChanged="OnCollectStartListSelectionChanged"
                                                                 PreviewMouseLeftButtonUp="OnCollectStartListClick" />
                                                    </ScrollViewer>
                                                </StackPanel>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </StackPanel>
                                <TextBlock Text="по"
                                           VerticalAlignment="Center"
                                           Margin="10 0 10 0"
                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                <StackPanel Width="200">
                                    <TextBlock Text="До" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" />
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid Grid.Row="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="34" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="CollectEndInput"
                                                     Grid.Column="0"
                                                     Background="#161620"
                                                     Foreground="#EAEAEA"
                                                     BorderBrush="{StaticResource BorderBrushMuted}"
                                                     BorderThickness="1"
                                                     Padding="6 4"
                                                     IsReadOnly="True" />
                                            <Button Grid.Column="1"
                                                    x:Name="CollectEndToggle"
                                                    Background="#1F1F2A"
                                                    Foreground="#EAEAEA"
                                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                                    BorderThickness="1 1 1 1"
                                                    Click="OnCollectEndToggleClicked"
                                                    Padding="0"
                                                    Width="34"
                                                    Height="Auto">
                                                <Path Data="M 0 0 L 4 4 L 8 0 Z"
                                                      Fill="#EAEAEA"
                                                      Stretch="Uniform"
                                                      Width="12"
                                                      Height="8"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                            </Button>
                                        </Grid>
                                        <Popup x:Name="CollectEndPopup"
                                               Placement="Bottom"
                                               PlacementTarget="{Binding ElementName=CollectEndInput}"
                                               AllowsTransparency="True"
                                               StaysOpen="True">
                                            <Border Background="#161620"
                                                    BorderBrush="{StaticResource BorderBrushMuted}"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="6"
                                                    Width="{Binding ActualWidth, ElementName=CollectEndInput}"
                                                    MaxHeight="260">
                                                <StackPanel>
                                                    <TextBox x:Name="CollectEndSearch"
                                                             Background="#1F1F2A"
                                                             Foreground="#EAEAEA"
                                                             BorderBrush="{StaticResource BorderBrushMuted}"
                                                             BorderThickness="1"
                                                             Padding="4"
                                                             Margin="0 0 0 6"
                                                             TextChanged="OnCollectEndSearchChanged"
                                                             PreviewKeyDown="OnCollectEndSearchPreviewKeyDown"
                                                             GotFocus="OnCollectEndSearchGotFocus" />
                                                    <ScrollViewer MaxHeight="200"
                                                                  VerticalScrollBarVisibility="Auto">
                                                        <ListBox x:Name="CollectEndList"
                                                                 Background="Transparent"
                                                                 BorderThickness="0"
                                                                 Foreground="#EAEAEA"
                                                                 SelectionChanged="OnCollectEndListSelectionChanged"
                                                                 PreviewMouseLeftButtonUp="OnCollectEndListClick" />
                                                    </ScrollViewer>
                                                </StackPanel>
                                            </Border>
                                        </Popup>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>

                            <TextBlock Text="Дополнительно" Foreground="{StaticResource TextSecondaryBrush}" Margin="0 4 0 6" />
                            <StackPanel Orientation="Vertical" Margin="0 0 0 12">
                                <CheckBox x:Name="CollectIncludeCash"
                                          Content="Добавить всю папку CashServer"
                                          Foreground="{StaticResource TextPrimaryBrush}"
                                          Margin="0 0 6 6"
                                          Style="{StaticResource ToggleCheckBox}"
                                          Checked="OnCollectCashToggleChanged"
                                          Unchecked="OnCollectCashToggleChanged" />
                                <CheckBox x:Name="CollectIncludeEntities"
                                          Content="Собрать БД"
                                          Foreground="{StaticResource TextPrimaryBrush}"
                                          Margin="0 0 6 0"
                                          Style="{StaticResource ToggleCheckBox}"
                                          Checked="OnCollectEntitiesToggleChanged"
                                          Unchecked="OnCollectEntitiesToggleChanged" />
                                <StackPanel x:Name="CollectEntitiesOptions"
                                            Margin="26 6 0 0"
                                            Visibility="Collapsed">
                                    <CheckBox x:Name="CollectEntitiesAll"
                                              Content="Собрать всё"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 6"
                                              Checked="OnCollectEntitiesAllChanged"
                                              Unchecked="OnCollectEntitiesAllChanged" />
                                    <CheckBox x:Name="CollectEntitiesFront"
                                              Content="Собрать БД фронта"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 4"
                                              Checked="OnCollectEntitiesOptionChanged"
                                              Unchecked="OnCollectEntitiesOptionChanged" />
                                    <CheckBox x:Name="CollectEntitiesEvents"
                                              Content="Собрать БД ивентов"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 4"
                                              Checked="OnCollectEntitiesOptionChanged"
                                              Unchecked="OnCollectEntitiesOptionChanged" />
                                    <CheckBox x:Name="CollectEntitiesPlugins"
                                              Content="Собрать БД плагинов"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 4"
                                              Checked="OnCollectEntitiesOptionChanged"
                                              Unchecked="OnCollectEntitiesOptionChanged" />
                                    <CheckBox x:Name="CollectEntitiesSearch"
                                              Content="Собрать БД поиска"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 4"
                                              Checked="OnCollectEntitiesOptionChanged"
                                              Unchecked="OnCollectEntitiesOptionChanged" />
                                    <CheckBox x:Name="CollectEntitiesSync"
                                              Content="Собрать БД синхронизации"
                                              Style="{StaticResource ToggleCheckBox}"
                                              Margin="0 0 0 0"
                                              Checked="OnCollectEntitiesOptionChanged"
                                              Unchecked="OnCollectEntitiesOptionChanged" />
                                </StackPanel>
                                <CheckBox x:Name="CollectIncludeMsinfo"
                                          Content="Добавить сведения msinfo32"
                                          Foreground="{StaticResource TextPrimaryBrush}"
                                          Margin="0 10 6 0"
                                          Style="{StaticResource ToggleCheckBox}" />
                                <CheckBox x:Name="CollectIncludeNetDiag"
                                          Content="Добавить сетевую диагностику"
                                          Foreground="{StaticResource TextPrimaryBrush}"
                                          Margin="0 8 6 0"
                                          Style="{StaticResource ToggleCheckBox}"
                                          Checked="OnCollectNetDiagToggleChanged"
                                          Unchecked="OnCollectNetDiagToggleChanged" />
                                <StackPanel x:Name="CollectNetDiagOptions"
                                            Margin="26 6 0 0"
                                            Visibility="Collapsed">
                                    <TextBlock Text="Сервер"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0 0 0 4" />
                                    <TextBox x:Name="CollectNetDiagServerInput"
                                             Background="#161620"
                                             Foreground="#EAEAEA"
                                             BorderBrush="{StaticResource BorderBrushMuted}"
                                             BorderThickness="1"
                                             Padding="6 4"
                                             MinWidth="220" />
                                    <TextBlock Text="Будет использован встроенный скрипт"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0 8 0 0" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel x:Name="CollectProgressPanel"
                                    Orientation="Horizontal"
                                    Visibility="Collapsed"
                                    Margin="0 8 0 0"
                                    VerticalAlignment="Center">
                            <ProgressBar x:Name="CollectProgressBar"
                                         Width="200"
                                         Height="10"
                                         IsIndeterminate="False"
                                         Minimum="0"
                                         Maximum="100"
                                         Margin="0 0 10 0" />
                            <TextBlock x:Name="CollectProgressText"
                                       VerticalAlignment="Center"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 16 0 0">
                            <Button x:Name="CollectCancelButton"
                                    Content="Отмена"
                                    Style="{StaticResource BaseButton}"
                                    Width="110"
                                    Margin="0 0 10 0"
                                    Click="OnLogCollectCancelClicked" />
                            <Button x:Name="CollectAcceptButton"
                                    Content="Собрать"
                                    Style="{StaticResource AccentButton}"
                                    Width="140"
                                    Click="OnLogCollectAcceptClicked" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
